# RC카 주행 하드웨커

자율주행 RC카 제작 과정에서 사용한 **구동부/전원부 하드웨어 구성**과  
특히 **서보 모터 전원 문제를 해결하기까지의 원인 분석 및 수정 과정** 정리



## 1. 펌웨어 보드

- **보드명**: STM NUCLEO-F103RB
- **MCU**: STM32F103RB
- **역할**
  - 전체 시스템 제어
  - 모터 드라이버(TB6612) 제어
  - 서보 모터 PWM 신호 출력
- **참고**
  - ([STM32 펌웨어 문서](../FreeRTOS/README.md))

---

## 2. 모터 드라이버

- **부품명**: TB6612FNG
- **역할**
  - DC 모터 구동을 위한 듀얼 H-Bridge 모터 드라이버
  - PWM을 이용한 속도 제어 및 방향 제어

### 주요 핀 구성 및 역할

| 핀 이름 | 역할 | STM32 연결 |
|-------|------|-----------|
| VM | 모터 전원 입력 | 배터리(3S) 전원 |
| VCC | 로직 전원 | STM32 5V |
| GND | 공통 그라운드 | STM32 GND |
| AIN1 / AIN2 | 모터 A 방향 제어 | GPIO |
| PWMA | 모터 A 속도 제어 | TIM PWM |
| STBY | 드라이버 활성화 | GPIO |
| A1 / A2 | 모터 출력 | DC 모터 |

### 선택 이유
- 기존 L298N 대비 전압 강하가 적고 효율이 높음
- 3.3V / 5V 로직 호환
- 소형, 저발열

---

## 3. DC 모터

- **모델명**: RF-307CA
- **타입**: 브러시드 DC 모터
- **정격 전압**: 약 6V
- **역할**
  - 차량 구동용 DC 모터

### 연결 방식
- TB6612의 A1 / A2 출력에 연결
- 모터 전원은 **배터리 직렬연결 전압(약 12V)** 사용

---

## 4. 서보 모터

- **모델명**: MG996R
- **개수**: 3개
- **용도**
  - 조향
  - 기타 기구 구동

### 전기적 특성
- **동작 전압**: 4.8 ~ 6V
- **평균 동작 전류**: 약 0.5 ~ 0.8A
- **피크 전류 (Stall / 급격한 부하 시)**:
  - **개당 2A 이상**
  - 3개 동시 동작 시 **순간적으로 5~6A 이상 가능**

### 초기 문제 상황
- 배터리 구성: **3.6V 18650 × 4 병렬**
- 현상:
  - 서보 모터가 처음에는 동작
  - **여러 서보를 동시에 움직이게 하려는 순간 멈춤**
- 원인 분석:
  - 순간적으로 전류가 튀어 배터리의 방전이 일어남
  - 부스트 컨버터 사용 시
    - 서보 피크 전류 요구 → 입력 전류 급증
    - 전압 강하 발생
    - 서보 내부 제어 보드 리셋 → 동작 중단
- 결론:
  - 서보는 전압이 순간적으로 떨어지는 것에 매우 민감
  - 이를 해결하기 위한 방법으로 3구 직렬연결 배터리를 사용하기로 결정

---

## 5. 스텝다운 전원 모듈

> **서보 모터 전원 문제를 해결하기 위해 수정한 부분**

- **타입**: DC-DC Buck Converter (Step-down)
- **출력 전압**: 5V
- **주요 구성**
  - **330µH 인덕터(330)**
  - 출력 캐패시터 내장

### 역할
- 배터리 전압(약 11V)을 **안정적인 5V로 변환**
- 서보 모터 전원 전용 공급

### 동작 원리 요약
- 입력: 약 11V (3.6V * 3)
- 출력: 5V
- 인덕터 + 스위칭 제어를 통해:
  - 서보가 순간적으로 큰 전류를 요구할 때
  - 벅 컨버터가 **입력 전압 쪽에서 전류를 더 끌어와**
  - 출력 5V를 유지

### 전류 관점
- 서보 3개 피크 시:
  - 출력 기준: 약 5~6A 순간 요구
  - 입력 기준(11V): 약 3A 수준
- 기존 3.6V 부스트 구조 대비:
  - 입력 전류 부담 대폭 감소
  - 전압 안정성 확보

---

## 6. 배터리 구성 변경

- **배터리 타입**: ICR 18650
- **정격 전압**: 3.6V
- **용량**: 3500mAh
- **구성**: 3구 직렬 (3S)
- **총 전압**
  - 완충 시: 약 12.6V
  - 사용 중: 약 11.1V

### 배선 구성
- 배터리 홀더에서 나온 **DC Y-스플리터 케이블을 절단 후 납땜**
- 전원 분기:
  1. 배터리 전압 → TB6612 VM (DC 모터 전원)
  2. 배터리 전압 → 스텝다운 전원 모듈 → 5V → 서보 모터

### 변경 효과
- 전압 여유 확보
- 서보 피크 전류 상황에서도 전압 하강 발생하지 않음
- 커패시터 없이도 안정적으로 동작 확인

---

## 7. 전체 회로 구성 요약

### 사용 부품
- STM32 NUCLEO-F103RB
- Bread Board
- TB6612FNG 모터 드라이버
- DC-DC Step-down 전원 모듈
- 배터리 홀더
- 18650 배터리 3구 (3S)
- DC 모터 1개 (RF-307CA)
- 서보 모터 3개 (MG996R)
- 전해 캐패시터 470µF × 3 (서보 전원 안정화용, 선택적)

### 구성 개요
- STM32 → 모터 드라이버 제어
- 배터리 → 모터 드라이버 (DC 모터)
- 배터리 → 스텝다운 → 서보 모터
- 모든 GND 공통

※ 회로도 및 배선 그림


---

## 정리

- 서보 모터 문제의 본질은 **전류가 아니라 전압 안정성**
- 병렬 배터리보다 **직렬 배터리 + 벅(Buck) 컨버터 구조가 훨씬 안정적**
- 커패시터는 필수는 아니지만 안정성 마진을 높여주는 보조 수단
- 전원 구조를 근본적으로 바꾸는 것이 가장 효과적인 해결책이었음
